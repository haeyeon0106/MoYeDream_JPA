<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MoYeoDream!</title>
    <link href="//spoqa.github.io/spoqa-han-sans/css/SpoqaHanSansNeo.css" rel="stylesheet" type="text/css">
    <link rel="stylesheet" type="text/css" href="/css/header.css">
    <link rel="stylesheet" type="text/css" href="/css/login.css">
    <link rel="stylesheet" href="/css/myProfile.css">
</head>
<body>
        <div id="root" th:object="${member}">

            <header th:replace="~{/fragments/header::header}"></header>
            <!-- 헤더 부분 ↑ -->

            <form method="post" action="/member/modify" id="memberForm">
                <input type="text" style="display: none" th:field="*{memberNumber}">
                <div class="main-box">
                    <a th:href="@{/member/read(memberNumber=*{memberNumber})}">
                        <div class="back">
                            <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 448 512" color="808080" cursor="pointer" height="30" width="30" xmlns="http://www.w3.org/2000/svg" style="color: rgb(128, 128, 128);">
                                <path d="M257.5 445.1l-22.2 22.2c-9.4 9.4-24.6 9.4-33.9 0L7 273c-9.4-9.4-9.4-24.6 0-33.9L201.4 44.7c9.4-9.4 24.6-9.4 33.9 0l22.2 22.2c9.5 9.5 9.3 25-.4 34.3L136.6 216H424c13.3 0 24 10.7 24 24v32c0 13.3-10.7 24-24 24H136.6l120.5 114.8c9.8 9.3 10 24.8.4 34.3z"></path>
                            </svg>
                        </div>
                    </a>
                    <h1>내 정보 수정</h1>
                    <div class="img-input2">
                        <!--<img class="img-example" src="https://hola-post-image.s3.ap-northeast-2.amazonaws.com/default.PNG" alt="user avatar">-->
                        <div class="img-controller">
                            <label class="img-choose">
                                이미지 선택
                                <input id="imageUpload2" name="file" type="file" accept="image/*">
                            </label>
                            <input type="hidden" name="memberProfile" id="member-profile-name">
                            <button type="button" class="img-delete2">이미지 제거</button>
                        </div>
                    </div>
                    <div class="user-info-box">
                        <h3>닉네임</h3>
                        <input class="user-info-box-nickName" type="text" name="memberNickname" maxlength="9" placeholder="닉네임을 입력해주세요." th:field="*{memberNickname}">
                    </div>
                    <p class="info-1">
                        모여드림에서 사용되는 이름입니다. (9자 이내로 작성)
                    </p>
                    <hr>
                    <div class="user-info-box user-info-box2">
                        <h3>이메일</h3>
                        <input class="user-info-box-email" type="text" th:field="*{memberEmail}" readonly/>
                    </div>
                    <p class="info-1">
                        모여드림에서 사용되는 이메일입니다. (수정 불가)
                    </p>
                    <hr>
                    <!--<div class="user-info-box user-info-box2">
                        <h3>한 줄 소개</h3>
                        <input class="user-info-box-introduce " type="text" name="memberIntroduction" maxlength="30" placeholder="한 줄 소개가 비어있습니다" th:field="*{memberIntroduction}">
                    </div>
                    <p class="info-1">
                        나는 어떤 사람인가요? (30자 이내로 작성)
                    </p>
                    <hr>-->
                    <div class="user-info-box user-info-box2">
                        <h3>관심 분야 태그</h3>
                        <div class="user-info-box33">
                            <div class="user-info-box44">

                                <div class="select-control choice-boxx">
                                    <div class="choice-box-result choice-box-result--is-multi choice-box-result--has-value choice-box-result22">
                                        <ul class="cate-all-list">

                                            <li class="cateBlockk culture" value="culture">
                                                <div class="choice-box-result33 choice-box-value">
                                                    <div class="choice-valuee choice-box-value-label">
                                                        문화 • 예술
                                                    </div>
                                                    <div class="choice-value-cancell choice-box-value-removee">
                                                        <svg height="14" width="14" viewBox="0 0 20 20" aria-hidden="true" focusable="false" class="all-svgg">
                                                            <path d="M14.348 14.849c-0.469 0.469-1.229 0.469-1.697 0l-2.651-3.030-2.651 3.029c-0.469 0.469-1.229 0.469-1.697 0-0.469-0.469-0.469-1.229 0-1.697l2.758-3.15-2.759-3.152c-0.469-0.469-0.469-1.228 0-1.697s1.228-0.469 1.697 0l2.652 3.031 2.651-3.031c0.469-0.469 1.228-0.469 1.697 0s0.469 1.229 0 1.697l-2.758 3.152 2.758 3.15c0.469 0.469 0.469 1.229 0 1.698z"></path>
                                                        </svg>
                                                    </div>
                                                </div>
                                            </li>
                                            <li class="cateBlockk sports" value="sports">
                                                <div class="choice-box-result33 choice-box-value">
                                                    <div class="choice-valuee choice-box-value-label">
                                                        스포츠 • 레저
                                                    </div>
                                                    <div class="choice-value-cancell choice-box-value-removee">
                                                        <svg height="14" width="14" viewBox="0 0 20 20" aria-hidden="true" focusable="false" class="all-svgg">
                                                            <path d="M14.348 14.849c-0.469 0.469-1.229 0.469-1.697 0l-2.651-3.030-2.651 3.029c-0.469 0.469-1.229 0.469-1.697 0-0.469-0.469-0.469-1.229 0-1.697l2.758-3.15-2.759-3.152c-0.469-0.469-0.469-1.228 0-1.697s1.228-0.469 1.697 0l2.652 3.031 2.651-3.031c0.469-0.469 1.228-0.469 1.697 0s0.469 1.229 0 1.697l-2.758 3.152 2.758 3.15c0.469 0.469 0.469 1.229 0 1.698z"></path>
                                                        </svg>
                                                    </div>
                                                </div>
                                            </li>
                                            <li class="cateBlockk programming" value="programming">
                                                <div class="choice-box-result33 choice-box-value">
                                                    <div class="choice-valuee choice-box-value-label">
                                                        컴퓨터 • 프로그래밍
                                                    </div>
                                                    <div class="choice-value-cancell choice-box-value-removee">
                                                        <svg height="14" width="14" viewBox="0 0 20 20" aria-hidden="true" focusable="false" class="all-svgg">
                                                            <path d="M14.348 14.849c-0.469 0.469-1.229 0.469-1.697 0l-2.651-3.030-2.651 3.029c-0.469 0.469-1.229 0.469-1.697 0-0.469-0.469-0.469-1.229 0-1.697l2.758-3.15-2.759-3.152c-0.469-0.469-0.469-1.228 0-1.697s1.228-0.469 1.697 0l2.652 3.031 2.651-3.031c0.469-0.469 1.228-0.469 1.697 0s0.469 1.229 0 1.697l-2.758 3.152 2.758 3.15c0.469 0.469 0.469 1.229 0 1.698z"></path>
                                                        </svg>
                                                    </div>
                                                </div>
                                            </li>
                                            <li class="cateBlockk foreign" value="foreign">
                                                <div class="choice-box-result33 choice-box-value">
                                                    <div class="choice-valuee choice-box-value-label">
                                                        외국어 • 토익 • 토플
                                                    </div>
                                                    <div class="choice-value-cancell choice-box-value-removee">
                                                        <svg height="14" width="14" viewBox="0 0 20 20" aria-hidden="true" focusable="false" class="all-svgg">
                                                            <path d="M14.348 14.849c-0.469 0.469-1.229 0.469-1.697 0l-2.651-3.030-2.651 3.029c-0.469 0.469-1.229 0.469-1.697 0-0.469-0.469-0.469-1.229 0-1.697l2.758-3.15-2.759-3.152c-0.469-0.469-0.469-1.228 0-1.697s1.228-0.469 1.697 0l2.652 3.031 2.651-3.031c0.469-0.469 1.228-0.469 1.697 0s0.469 1.229 0 1.697l-2.758 3.152 2.758 3.15c0.469 0.469 0.469 1.229 0 1.698z"></path>
                                                        </svg>
                                                    </div>
                                                </div>
                                            </li>
                                            <li class="cateBlockk science" value="science">
                                                <div class="choice-box-result33 choice-box-value">
                                                    <div class="choice-valuee choice-box-value-label">
                                                        인문 • 과학
                                                    </div>
                                                    <div class="choice-value-cancell choice-box-value-removee">
                                                        <svg height="14" width="14" viewBox="0 0 20 20" aria-hidden="true" focusable="false" class="all-svgg">
                                                            <path d="M14.348 14.849c-0.469 0.469-1.229 0.469-1.697 0l-2.651-3.030-2.651 3.029c-0.469 0.469-1.229 0.469-1.697 0-0.469-0.469-0.469-1.229 0-1.697l2.758-3.15-2.759-3.152c-0.469-0.469-0.469-1.228 0-1.697s1.228-0.469 1.697 0l2.652 3.031 2.651-3.031c0.469-0.469 1.228-0.469 1.697 0s0.469 1.229 0 1.697l-2.758 3.152 2.758 3.15c0.469 0.469 0.469 1.229 0 1.698z"></path>
                                                        </svg>
                                                    </div>
                                                </div>
                                            </li>
                                            <li class="cateBlockk finance" value="finance">
                                                <div class="choice-box-result33 choice-box-value">
                                                    <div class="choice-valuee choice-box-value-label">
                                                        경제 • 금융
                                                    </div>
                                                    <div class="choice-value-cancell choice-box-value-removee">
                                                        <svg height="14" width="14" viewBox="0 0 20 20" aria-hidden="true" focusable="false" class="all-svgg">
                                                            <path d="M14.348 14.849c-0.469 0.469-1.229 0.469-1.697 0l-2.651-3.030-2.651 3.029c-0.469 0.469-1.229 0.469-1.697 0-0.469-0.469-0.469-1.229 0-1.697l2.758-3.15-2.759-3.152c-0.469-0.469-0.469-1.228 0-1.697s1.228-0.469 1.697 0l2.652 3.031 2.651-3.031c0.469-0.469 1.228-0.469 1.697 0s0.469 1.229 0 1.697l-2.758 3.152 2.758 3.15c0.469 0.469 0.469 1.229 0 1.698z"></path>
                                                        </svg>
                                                    </div>
                                                </div>
                                            </li>
                                            <li class="cateBlockk politics" value="politics">
                                                <div class="choice-box-result33 choice-box-value">
                                                    <div class="choice-valuee choice-box-value-label">
                                                        정치 • 사회
                                                    </div>
                                                    <div class="choice-value-cancell choice-box-value-removee">
                                                        <svg height="14" width="14" viewBox="0 0 20 20" aria-hidden="true" focusable="false" class="all-svgg">
                                                            <path d="M14.348 14.849c-0.469 0.469-1.229 0.469-1.697 0l-2.651-3.030-2.651 3.029c-0.469 0.469-1.229 0.469-1.697 0-0.469-0.469-0.469-1.229 0-1.697l2.758-3.15-2.759-3.152c-0.469-0.469-0.469-1.228 0-1.697s1.228-0.469 1.697 0l2.652 3.031 2.651-3.031c0.469-0.469 1.228-0.469 1.697 0s0.469 1.229 0 1.697l-2.758 3.152 2.758 3.15c0.469 0.469 0.469 1.229 0 1.698z"></path>
                                                        </svg>
                                                    </div>
                                                </div>
                                            </li>
                                            <li class="cateBlockk certificate" value="certificate">
                                                <div class="choice-box-result33 choice-box-value">
                                                    <div class="choice-valuee choice-box-value-label">
                                                        자격증
                                                    </div>
                                                    <div class="choice-value-cancell choice-box-value-removee">
                                                        <svg height="14" width="14" viewBox="0 0 20 20" aria-hidden="true" focusable="false" class="all-svgg">
                                                            <path d="M14.348 14.849c-0.469 0.469-1.229 0.469-1.697 0l-2.651-3.030-2.651 3.029c-0.469 0.469-1.229 0.469-1.697 0-0.469-0.469-0.469-1.229 0-1.697l2.758-3.15-2.759-3.152c-0.469-0.469-0.469-1.228 0-1.697s1.228-0.469 1.697 0l2.652 3.031 2.651-3.031c0.469-0.469 1.228-0.469 1.697 0s0.469 1.229 0 1.697l-2.758 3.152 2.758 3.15c0.469 0.469 0.469 1.229 0 1.698z"></path>
                                                        </svg>
                                                    </div>
                                                </div>
                                            </li>
                                            <li class="cateBlockk officiary" value="officiary">
                                                <div class="choice-box-result33 choice-box-value">
                                                    <div class="choice-valuee choice-box-value-label">
                                                        공무원
                                                    </div>
                                                    <div class="choice-value-cancell choice-box-value-removee">
                                                        <svg height="14" width="14" viewBox="0 0 20 20" aria-hidden="true" focusable="false" class="all-svgg">
                                                            <path d="M14.348 14.849c-0.469 0.469-1.229 0.469-1.697 0l-2.651-3.030-2.651 3.029c-0.469 0.469-1.229 0.469-1.697 0-0.469-0.469-0.469-1.229 0-1.697l2.758-3.15-2.759-3.152c-0.469-0.469-0.469-1.228 0-1.697s1.228-0.469 1.697 0l2.652 3.031 2.651-3.031c0.469-0.469 1.228-0.469 1.697 0s0.469 1.229 0 1.697l-2.758 3.152 2.758 3.15c0.469 0.469 0.469 1.229 0 1.698z"></path>
                                                        </svg>
                                                    </div>
                                                </div>
                                            </li>
                                            <li class="cateBlockk employment" value="employment">
                                                <div class="choice-box-result33 choice-box-value">
                                                    <div class="choice-valuee choice-box-value-label">
                                                        취업 • 면접
                                                    </div>
                                                    <div class="choice-value-cancell choice-box-value-removee">
                                                        <svg height="14" width="14" viewBox="0 0 20 20" aria-hidden="true" focusable="false" class="all-svgg">
                                                            <path d="M14.348 14.849c-0.469 0.469-1.229 0.469-1.697 0l-2.651-3.030-2.651 3.029c-0.469 0.469-1.229 0.469-1.697 0-0.469-0.469-0.469-1.229 0-1.697l2.758-3.15-2.759-3.152c-0.469-0.469-0.469-1.228 0-1.697s1.228-0.469 1.697 0l2.652 3.031 2.651-3.031c0.469-0.469 1.228-0.469 1.697 0s0.469 1.229 0 1.697l-2.758 3.152 2.758 3.15c0.469 0.469 0.469 1.229 0 1.698z"></path>
                                                        </svg>
                                                    </div>
                                                </div>
                                            </li>
                                        </ul>

                                        <input value="" name="memberInterests" id="memberInterests" type="text" style="display: none">
                                    </div>
                                    <div class="select__indicators css-1wy0on6">
                                        <div class="select__indicator select__clear-indicator css-tlfecz-indicatorContainerr delete-all-selectt" aria-hidden="true">
                                            <svg height="20" width="20" viewBox="0 0 20 20" aria-hidden="true" focusable="false" class="all-svgg">
                                                <path d="M14.348 14.849c-0.469 0.469-1.229 0.469-1.697 0l-2.651-3.030-2.651 3.029c-0.469 0.469-1.229 0.469-1.697 0-0.469-0.469-0.469-1.229 0-1.697l2.758-3.15-2.759-3.152c-0.469-0.469-0.469-1.228 0-1.697s1.228-0.469 1.697 0l2.652 3.031 2.651-3.031c0.469-0.469 1.228-0.469 1.697 0s0.469 1.229 0 1.697l-2.758 3.152 2.758 3.15c0.469 0.469 0.469 1.229 0 1.698z"></path>
                                            </svg>
                                        </div>
                                        <span class="select__indicator-separator css-1okebmr-indicatorSeparatorr"></span>
                                        <div class="select__indicator select__dropdown-indicator css-tlfecz-indicatorContainerr open-selectt" aria-hidden="true">
                                            <svg height="20" width="20" viewBox="0 0 20 20" aria-hidden="true" focusable="false" class="all-svgg">
                                                <path d="M4.516 7.548c0.436-0.446 1.043-0.481 1.576 0l3.908 3.747 3.908-3.747c0.533-0.481 1.141-0.446 1.574 0 0.436 0.445 0.408 1.197 0 1.615-0.406 0.418-4.695 4.502-4.695 4.502-0.217 0.223-0.502 0.335-0.787 0.335s-0.57-0.112-0.789-0.335c0 0-4.287-4.084-4.695-4.502s-0.436-1.17 0-1.615z"></path>
                                            </svg>
                                        </div>
                                    </div>
                                </div>
                                <div class="select-boxx">
                                    <ul class="select-box22">
                                        <li class="select-valuee" value="culture" >문화 • 예술</li>
                                        <li class="select-valuee" value="sports">스포츠 • 레저</li>
                                        <li class="select-valuee" value="programming">컴퓨터 • 프로그래밍</li>
                                        <li class="select-valuee" value="foreign">외국어 • 토익 • 토플</li>
                                        <li class="select-valuee" value="science">인문 • 과학</li>
                                        <li class="select-valuee" value="finance">경제 • 금융</li>
                                        <li class="select-valuee" value="politics">정치 • 사회</li>
                                        <li class="select-valuee" value="certificate">자격증</li>
                                        <li class="select-valuee" value="officiary">공무원</li>
                                        <li class="select-valuee" value="employment">취업 • 면접</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                    <p class="info-1">관심 있는 분야 태그를 등록해주세요. (최대 5개까지)</p>
                    <hr>
                    <button type="button" class="button-fin button-css">
                        완료
                    </button>
                    <button type="button" class="button-withdraw button-css">
                        회원탈퇴
                    </button>
                </div>
            </form>
        </div>

        <div class="delete-confirm-window">
            <div class="sc-bdnxRM MTMzf">
                <div class="cancelButton_wrapper__1bRq9">
                    <div>MoYeoDream에서 계정을 삭제하시겠어요?</div>
                    <section class="cancelButton_buttons__2SCwD">
                        <button class="cancelButton_cancelButton__1wL0W">아니요</button>
                        <button class="cancelButton_registerButton__2q_So"><a th:href="@{/member/remove(memberNumber=${member.memberNumber})}">네, 삭제할래요</a></button>
                    </section>
                </div>
            </div>
        </div>

</body>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://developers.kakao.com/sdk/js/kakao.js"></script>
<script th:inline="javascript">
    let memberNumber = [[${session.memberNumber}]];
</script>
<script src="/js/header.js"></script>
<script src="/js/login.js"></script>
<script src="/js/myProfile.js"></script>
<script th:inline="javascript">

    // 받아올 카테고리
    let memberInterests = [[${member.memberInterests}]];

    const $inputNickName = $("input.user-info-box-nickName");
    const $registerButton = $("button.button-fin");


    let interestsList = "";
    let interest = new Array();



    let uploadBoolean = 0;


    let filesLeaderProfile = [[${member.memberProfile}]];
    const $resultLocation = $(".img-input2");

    //첨부파일
    if (filesLeaderProfile != null) {
        $resultLocation.prepend("<img class=\"img-example2\" src='/file/displayProfile?path=" + filesLeaderProfile + "'>");
    } else {
        $resultLocation.prepend("<img class=\"img-example2\" src='https://hola-post-image.s3.ap-northeast-2.amazonaws.com/default.PNG'>");
    }

    const imgThumbnail2 = document.querySelector(".img-example2");
    const imgFile2 = document.querySelector("input[id='imageUpload2']");
    const imgDelete2 = document.querySelector("button.img-delete2");

    let logoName2;

    imgFile2.addEventListener("change", function(event) {
        let reader = new FileReader();
        reader.readAsDataURL(event.target.files[0]);
        reader.onload = function(event) {
            let url = event.target.result;
            if(url.includes("image")) {
                imgThumbnail2.src = url;
            }
            else {
                imgThumbnail2.src = "https://hola-post-image.s3.ap-northeast-2.amazonaws.com/default.PNG";
            }
        }

        let formData2 = new FormData();
        let logoInput2 = $("input[type='file']");
        let profileFiles2 = logoInput2[1].files;
        console.log(profileFiles2[0]);

        logoName2 = $("input[type='file']")[1].files[0].name;

        formData2.append("file", profileFiles2[0]);

        $.ajax({
            url: "/file/uploadProfile",
            type: "POST",
            data: formData2,
            processData: false,
            contentType: false,
            success: function(fileName) {
                $("#member-profile-name").val(fileName);
                uploadBoolean = 1;
            }
        });
    });

    if(uploadBoolean == 0){
        $("#member-profile-name").val([[${member.memberProfile}]]);
    }

    imgDelete2.addEventListener("click", function() {
        imgFile2.value = "";
        imgThumbnail2.src = "https://hola-post-image.s3.ap-northeast-2.amazonaws.com/default.PNG";

        let path = $("#member-profile-name").val();
        console.log(path);

        $.ajax({
            url: "/file/deleteProfile",
            type: "DELETE",
            data: {path: path}
        });
        $("#member-profile-name").val('');
    });

    $registerButton.on("click", function () {

        if($inputNickName.val() == "") {
            alert("닉네임을 입력해주세요.");
        }
        else {
            for(let i = 0; i < $('li.cateBlockk').length; i++) {
                if ($($('li.cateBlockk')[i]).css("display") == "list-item") {
                    interest.push($($('li.cateBlockk')[i]).attr("value"));
                }
            }
            interestsList = interest.join(",");
            $("#memberInterests").attr('value',interestsList);

            if(uploadBoolean != 0) {
                $.ajax({
                    url: "/file/deleteProfile",
                    type: "delete",
                    data: {path: filesLeaderProfile},
                });
            }
            $("#memberForm").submit();
        }
    });

</script>
</html>